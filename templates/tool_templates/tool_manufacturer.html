<!-- templates/tool_templates/tool_manufacturer.html -->

{% set manufacturers = manufacturers | default([]) %}
{% set page = page | default(1) %}
{% set per_page = per_page | default(20) %}
{% set total_pages = total_pages | default(0) %}

<div class="tool-manufacturer-container">
    <!-- Accordion for Manufacturer Operations -->
    <div class="accordion" id="manufacturerAccordion">
        <!-- Add Manufacturer Accordion Item -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingAdd">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAdd" aria-expanded="true" aria-controls="collapseAdd">
                    Add Manufacturer
                </button>
            </h2>
            <div id="collapseAdd" class="accordion-collapse collapse show" aria-labelledby="headingAdd" data-bs-parent="#manufacturerAccordion">
                <div class="accordion-body">
                    <form id="add_manufacturer_form" enctype="multipart/form-data" method="POST" action="{{ url_for('tool_routes.add_manufacturer') }}">
                        <!-- CSRF Token -->
                        {{ manufacturer_form.hidden_tag() }}

                        <!-- Manufacturer Name Field -->
                        <div class="mb-3">
                            {{ manufacturer_form.name.label(class="form-label") }}
                            {{ manufacturer_form.name(class="form-control", placeholder="Enter manufacturer name") }}
                            <div class="invalid-feedback" id="add-error-name"></div>
                        </div>

                        <!-- Manufacturer Description Field -->
                        <div class="mb-3">
                            {{ manufacturer_form.description.label(class="form-label") }}
                            {{ manufacturer_form.description(class="form-control", placeholder="Enter manufacturer description") }}
                            <div class="invalid-feedback" id="add-error-description"></div>
                        </div>

                        <!-- Manufacturer Country Field -->
                        <div class="mb-3">
                            {{ manufacturer_form.country.label(class="form-label") }}
                            {{ manufacturer_form.country(class="form-control", placeholder="Enter country") }}
                            <div class="invalid-feedback" id="add-error-country"></div>
                        </div>

                        <!-- Manufacturer Website Field -->
                        <div class="mb-3">
                            {{ manufacturer_form.website.label(class="form-label") }}
                            {{ manufacturer_form.website(class="form-control", placeholder="Enter website URL", type="url") }}
                            <div class="invalid-feedback" id="add-error-website"></div>
                        </div>

                        <!-- Submit Button -->
                        <div class="text-end mt-4">
                            {{ manufacturer_form.submit(class="btn btn-primary") }}
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Edit Manufacturer Accordion Item -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingEdit">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEdit" aria-expanded="false" aria-controls="collapseEdit">
                    Edit Manufacturer
                </button>
            </h2>
            <div id="collapseEdit" class="accordion-collapse collapse" aria-labelledby="headingEdit" data-bs-parent="#manufacturerAccordion">
                <div class="accordion-body">
                    <form id="edit_manufacturer_form" method="POST" action="{{ url_for('tool_routes.edit_manufacturer') }}">
                        <!-- CSRF Token -->
                        {{ manufacturer_form.hidden_tag() }}

                        <!-- Hidden field for Manufacturer ID -->
                        <input type="hidden" id="edit-manufacturer-id" name="manufacturer_id">

                        <!-- Manufacturer Name Field -->
                        <div class="mb-3">
                            <label for="edit-manufacturer-name" class="form-label">Manufacturer Name</label>
                            <input type="text" class="form-control" id="edit-manufacturer-name" name="name" placeholder="Enter manufacturer name">
                            <div class="invalid-feedback" id="edit-error-name"></div>
                        </div>

                        <!-- Manufacturer Description Field -->
                        <div class="mb-3">
                            <label for="edit-manufacturer-description" class="form-label">Description</label>
                            <textarea class="form-control" id="edit-manufacturer-description" name="description" placeholder="Enter manufacturer description"></textarea>
                            <div class="invalid-feedback" id="edit-error-description"></div>
                        </div>

                        <!-- Manufacturer Country Field -->
                        <div class="mb-3">
                            <label for="edit-manufacturer-country" class="form-label">Country</label>
                            <input type="text" class="form-control" id="edit-manufacturer-country" name="country" placeholder="Enter country">
                            <div class="invalid-feedback" id="edit-error-country"></div>
                        </div>

                        <!-- Manufacturer Website Field -->
                        <div class="mb-3">
                            <label for="edit-manufacturer-website" class="form-label">Website</label>
                            <input type="url" class="form-control" id="edit-manufacturer-website" name="website" placeholder="Enter website URL">
                            <div class="invalid-feedback" id="edit-error-website"></div>
                        </div>

                        <!-- Submit Button -->
                        <div class="text-end mt-4">
                            <button type="submit" class="btn btn-primary">Update Manufacturer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Delete Manufacturer Accordion Item -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingDelete">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDelete" aria-expanded="false" aria-controls="collapseDelete">
                    Delete Manufacturer
                </button>
            </h2>
            <div id="collapseDelete" class="accordion-collapse collapse" aria-labelledby="headingDelete" data-bs-parent="#manufacturerAccordion">
                <div class="accordion-body">
                    <form id="delete_manufacturer_form" method="POST" action="{{ url_for('tool_routes.delete_manufacturer') }}">
                        <!-- CSRF Token -->
                        {{ manufacturer_form.hidden_tag() }}

                        <!-- Hidden field for Manufacturer ID -->
                        <input type="hidden" id="delete-manufacturer-id" name="manufacturer_id">

                        <!-- Manufacturer Name Field (Read-Only) -->
                        <div class="mb-3">
                            <label for="delete-manufacturer-name" class="form-label">Manufacturer Name</label>
                            <input type="text" class="form-control" id="delete-manufacturer-name" name="name" placeholder="Enter manufacturer name" readonly>
                        </div>

                        <!-- Delete Confirmation -->
                        <div class="mb-3">
                            <p>Are you sure you want to delete this manufacturer?</p>
                        </div>

                        <!-- Submit Button -->
                        <div class="text-end mt-4">
                            <button type="submit" class="btn btn-danger">Delete Manufacturer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Messages -->
    <div id="feedback-container" class="mt-3"></div>

    <!-- Manufacturers List Section -->
    <div class="mt-5">
        <h2>Manufacturers List</h2>
        <div id="manufacturers-results-container" class="results">
            {% if manufacturers %}
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Manufacturer Name</th>
                            <th>Description</th>
                            <th>Country</th>
                            <th>Website</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for manufacturer in manufacturers %}
                            <tr>
                                <td>{{ manufacturer.name }}</td>
                                <td>{{ manufacturer.description or 'N/A' }}</td>
                                <td>{{ manufacturer.country }}</td>
                                <td><a href="{{ manufacturer.website }}" target="_blank">{{ manufacturer.website }}</a></td>
                                <td>
                                    <button class="btn btn-sm btn-warning edit-manufacturer" data-id="{{ manufacturer.id }}">Edit</button>
                                    <button class="btn btn-sm btn-danger delete-manufacturer" data-id="{{ manufacturer.id }}">Delete</button>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <!-- Pagination Controls -->
                {% if total_pages > 1 %}
                    <nav aria-label="Manufacturers pages">
                        <ul class="pagination justify-content-center">
                            {% if page > 1 %}
                                <li class="page-item">
                                    <a class="page-link" href="#" data-page="{{ page - 1 }}" aria-label="Previous">
                                        <span aria-hidden="true">&laquo; Previous</span>
                                    </a>
                                </li>
                            {% else %}
                                <li class="page-item disabled">
                                    <span class="page-link" aria-label="Previous">
                                        <span aria-hidden="true">&laquo; Previous</span>
                                    </span>
                                </li>
                            {% endif %}

                            <li class="page-item disabled">
                                <span class="page-link">
                                    Page {{ page }} of {{ total_pages }}
                                </span>
                            </li>

                            {% if page < total_pages %}
                                <li class="page-item">
                                    <a class="page-link" href="#" data-page="{{ page + 1 }}" aria-label="Next">
                                        <span aria-hidden="true">Next &raquo;</span>
                                    </a>
                                </li>
                            {% else %}
                                <li class="page-item disabled">
                                    <span class="page-link" aria-label="Next">
                                        <span aria-hidden="true">Next &raquo;</span>
                                    </span>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                {% endif %}
            {% else %}
                <p>No manufacturers found.</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- JavaScript to Handle Edit Button Clicks -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle Edit Button Click
        document.querySelectorAll('.edit-manufacturer').forEach(function(button) {
            button.addEventListener('click', function() {
                const manufacturerId = this.getAttribute('data-id');
                const manufacturerName = this.closest('tr').querySelector('td:nth-child(1)').textContent;
                const manufacturerDescription = this.closest('tr').querySelector('td:nth-child(2)').textContent;
                const manufacturerCountry = this.closest('tr').querySelector('td:nth-child(3)').textContent;
                const manufacturerWebsite = this.closest('tr').querySelector('td:nth-child(4) a').href;

                // Populate the form fields
                document.getElementById('edit-manufacturer-id').value = manufacturerId;
                document.getElementById('edit-manufacturer-name').value = manufacturerName;
                document.getElementById('edit-manufacturer-description').value = manufacturerDescription;
                document.getElementById('edit-manufacturer-country').value = manufacturerCountry;
                document.getElementById('edit-manufacturer-website').value = manufacturerWebsite;

                // Expand the Edit accordion item
                const collapseEdit = document.getElementById('collapseEdit');
                const bsCollapse = new bootstrap.Collapse(collapseEdit, {
                    toggle: true
                });
            });
        });

        // Handle Delete Button Click (Optional)
        document.querySelectorAll('.delete-manufacturer').forEach(function(button) {
            button.addEventListener('click', function() {
                const manufacturerId = this.getAttribute('data-id');
                const manufacturerName = this.closest('tr').querySelector('td:nth-child(1)').textContent;

                // Populate the delete form fields
                document.getElementById('delete-manufacturer-id').value = manufacturerId;
                document.getElementById('delete-manufacturer-name').value = manufacturerName;

                // Expand the Delete accordion item
                const collapseDelete = document.getElementById('collapseDelete');
                const bsCollapse = new bootstrap.Collapse(collapseDelete, {
                    toggle: true
                });
            });
        });
    });
</script>
